<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function (m, e, t, r, i, k, a) {
            m[i] = m[i] || function () { (m[i].a = m[i].a || []).push(arguments) };
            m[i].l = 1 * new Date(); k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a)
        })
            (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

        ym(80552305, "init", {
            clickmap: true,
            trackLinks: true,
            accurateTrackBounce: true,
            webvisor: true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/80552305" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
</head>
<body>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css">
    <script src="scripts/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.js"></script>
<script>
        $(document).ready(() => {
            $('.ui.accordion').accordion();
            $("#getData").on("click", () => {
                $("#search").dimmer('show');
                $.ajax({
                    url: 'stat',
                    data: "chessId=" + $("#chess-id").val(),
                    success: function (result) {
                        $("#search").dimmer('hide');
                        $("#all-stat").show("fast");
                        $("#data").show("fast");
                        showResult(result);
                    },
                    error: function () {
                        $("#search").dimmer('hide');
                        alert("Произошла ошибка");
                    }
                });
            })
        })

        function showResult(result) {
            $("#name").html(result.info.name);
            // Заполняем топ-частых соперников
            var rivals = $("#rivals");
            rivals.html("");
            var index = 1;
            result.rivals.forEach(rival => {
                var row = $("<tr/>");
                row.append(addCell('#' + index++));
                row.append(addCell('<a href="https://ratings.ruchess.ru/people/' + rival.id + '" target="_blank">' + rival.name + '</a>'));
                row.append(addCell(rival.games));
                row.append(addCell(rival.wins));
                row.append(addCell(rival.draws));
                row.append(addCell(rival.loses));
                rivals.append(row);
            });
            // Статистика
            $("#games").text(result.info.games);
            $("#wins").text(result.info.wins);
            $("#draws").text(result.info.draws);
            $("#loses").text(result.info.loses);
            $('.count').each(function () {
                $(this).prop('Counter', 0).animate({
                    Counter: $(this).text()
                },
                    {
                        duration: 1000,
                        easing: 'swing',
                        step: function (now) {
                            this.innerHTML = Math.ceil(now).toString().replace(/(\d)(?=(\d{3})+(\D|$))/g, '$1&thinsp;');
                        }
                    });
            });
            // Сила игры разными цветами
            var gameStrengths = $("#gameStrengths");
            gameStrengths.html("");

            result.gameStrengths.forEach(rivals => {
                var row = $("<tr/>");
                switch (rivals.strength) {
                    case 0:
                        row.append("<td><strong>Слабые</strong></td>");
                        break;
                    case 1:
                        row.append("<td><strong>Равные</strong></td>");
                        break;
                    case 2:
                        row.append("<td><strong>Сильные</strong></td>");
                        break;
                }
                row.append(addCell(rivals.white.wins));
                row.append(addCell(rivals.black.wins));
                row.append(addCell(rivals.white.draw));
                row.append(addCell(rivals.black.draw));
                row.append(addCell(rivals.white.loses));
                row.append(addCell(rivals.black.loses));
                row.append(addCell(Math.ceil(rivals.white.points * 100 / rivals.white.games) + "%"));
                row.append(addCell(Math.ceil(rivals.black.points * 100 / rivals.black.games) + "%"));
                gameStrengths.append(row);
            })

            // Заполняем топ-сложных соперников
            var hardestGames = $("#hardestGames");
            hardestGames.html("");
            index = 1;
            result.hardestRivals.forEach(rival => {
                var row = $("<tr/>");
                row.append(addCell('#' + index++));
                row.append(addCell('<a href="https://ratings.ruchess.ru/people/' + rival.id + '" target="_blank">' + rival.name + '</a>'));
                row.append(addCell(rival.elo));
                row.append(addCell(rival.date));
                row.append(addCell(rival.tournament));
                row.append(addCell(rival.color));
                hardestGames.append(row);
            });
            // Сила игры по ходу турнира
            var toursStats = $("#toursStats");
            toursStats.html("");
            result.tournamentStats.forEach(tours => {
                toursStats.append("<strong>Турнир из " + tours.length + " туров</strong>")
                var table = $('<table class="ui unstackable selectable right aligned table">');
                var thead = $('<thead>');
                var tbody = $('<tbody>');
                var tourRow = $('<tr>');
                var eloRow = $('<tr>');
                var percentRow = $('<tr>');
                var winsRow = $('<tr>');
                var drawsRow = $('<tr>');
                var losesRow = $('<tr>');
                var gamesRow = $('<tr>');

                var index = 1;
                tourRow.append('<th></th>');
                eloRow.append('<td>Средний ЭЛО соперников</td>');
                percentRow.append('<td>% набранных очков</td>');
                winsRow.append('<td>Побед</td>');
                drawsRow.append('<td>Ничьих</td>');
                losesRow.append('<td>Поражений</td>');
                gamesRow.append('<td>Всего Игр</td>');

                tours.forEach(tour => {
                    tourRow.append('<th>' + index++ + '</th>');
                    eloRow.append('<td>' + tour.avgElo + '</td>');

                    var percentColor = ''
                    if (tour.pointPercent >= 75) percentColor = 'green';
                    else if (tour.pointPercent >= 50) percentColor = 'olive';
                    else if (tour.pointPercent >= 25) percentColor = 'yellow';
                    else percentColor = 'orange';
                    percentRow.append('<td class="' + percentColor +'">' + tour.pointPercent + '%</td>');
                    winsRow.append('<td>' + tour.wins + '</td>');
                    drawsRow.append('<td>' + tour.draws + '</td>');
                    losesRow.append('<td>' + tour.loses + '</td>');
                    gamesRow.append('<td>' + tour.games + '</td>');
                })
                thead.append(tourRow);
                tbody.append(eloRow);
                tbody.append(percentRow);
                tbody.append(winsRow);
                tbody.append(drawsRow);
                tbody.append(losesRow);
                tbody.append(gamesRow);

                table.append(thead);
                table.append(tbody);

                toursStats.append(table);
            })
            // Неудобные соперники
            var inconvenientOpponent = $("#inconvenientOpponent");
            inconvenientOpponent.html('');
            index = 1;
            result.inconvenientOpponent.forEach(op => {
                var row = $("<tr>");
                row.append(addCell(index++));
                row.append(addCell(op.name));
                row.append(addCell(Math.ceil(100*op.points/op.games)));
                row.append(addCell(op.wins));
                row.append(addCell(op.draws));
                row.append(addCell(op.loses));
                row.append(addCell(op.games));
                inconvenientOpponent.append(row);                
            })
        }

        function addCell(data) {
            var cell = $("<td/>");
            cell.html(data);
            return cell;
        }
    </script>
<div class="ui container">
    <div class="ui clearing segment">
        <h1 class="ui left floated header" style="margin-bottom: 0">Статистика РШФ</h1>
        <h3 id="name" class="ui right floated header"></h3>
    </div>
    <div id="search" class="ui segment">
        <div class="ui dimmer">
            <div class="ui loader"></div>
        </div>
        <div class="ui form">
            <div class="fields" style="margin-bottom: 0">
                <div class="field">
                    <input type="text" id="chess-id" placeholder="ID РШФ" />
                </div>
                <div class="field">
                    <input class="ui button" type="button" id="getData" value="Получить" />
                </div>
            </div>
        </div>
    </div>
    <div id="all-stat" style="display: none" class="ui center aligned segment">
        <div class="ui four column center aligned divided relaxed stackable grid container">
            <div class="column">
                <div class="ui statistic">
                    <div id="games" class="value count">0</div>
                    <div class="label">Игр</div>
                </div>
            </div>
            <div class="column">
                <div class="ui statistic">
                    <div id="wins" class="value count">0</div>
                    <div class="label">Побед</div>
                </div>
            </div>
            <div class="column">
                <div class="ui statistic">
                    <div id="draws" class="value count">0</div>
                    <div class="label">Ничьих</div>
                </div>
            </div>
            <div class="column">
                <div class="ui statistic">
                    <div id="loses" class="value count">0</div>
                    <div class="label">Поражений</div>
                </div>
            </div>
        </div>
    </div>
    <div id="data" style="display: none" class="ui segment">
        <div class="ui fluid accordion">
            <div class="title">
                <i class="dropdown icon"></i>
                Сила игры и цвет
            </div>
            <div class="content">
                <table class="ui unstackable selectable table">
                    <thead>
                    <tr>
                        <th rowspan="2">Соперники</th>
                        <th colspan="2">Побед</th>
                        <th colspan="2">Ничьих</th>
                        <th colspan="2">Поражений</th>
                        <th colspan="2">% очков</th>
                    </tr>
                    <tr>
                        <th>Б</th>
                        <th>Ч</th>
                        <th>Б</th>
                        <th>Ч</th>
                        <th>Б</th>
                        <th>Ч</th>
                        <th>Б</th>
                        <th>Ч</th>
                    </tr>
                    </thead>
                    <tbody id="gameStrengths"></tbody>
                </table>
            </div>
            <div class="title">
                <i class="dropdown icon"></i>
                Топ-20 частых соперников
            </div>
            <div class="content">
                <table class="ui unstackable selectable table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Имя</th>
                            <th>Игр</th>
                            <th>Побед</th>
                            <th>Ничьих</th>
                            <th>Поражений</th>
                        </tr>
                    </thead>
                    <tbody id="rivals"></tbody>
                </table>
            </div>
            <div class="title">
                <i class="dropdown icon"></i>
                Топ-20 самых рейтинговых соперников, которые были обыграны
            </div>
            <div class="content">
                <table class="ui unstackable selectable table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Соперник</th>
                            <th>Рейтинг</th>
                            <th>Дата</th>
                            <th>Турнир</th>
                            <th>Цвет</th>
                        </tr>
                    </thead>
                    <tbody id="hardestGames"></tbody>
                </table>
            </div>
            <div class="title">
                <i class="dropdown icon"></i>
                Топ-20 самых неудобных соперников
            </div>
            <div class="content">
                <table class="ui unstackable selectable table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Соперник</th>
                            <th>% очков</th>
                            <th>Побед</th>
                            <th>Ничьих</th>
                            <th>Поражений</th>
                            <th>Игр</th>
                        </tr>
                    </thead>
                    <tbody id="inconvenientOpponent"></tbody>
                </table>
            </div>
            <div class="title">
                <i class="dropdown icon"></i>
                Сила игры по ходу турнира
            </div>
            <div class="content" id="toursStats"></div>
        </div>
    </div>
    <div class="ui segment">
        <div class="ui fluid accordion">
            <div class="title">
                <i class="dropdown icon"></i>
                О сайте
            </div>
            <div class="content">
                Сайт позволяет посмотреть статистику результатов игр в турнирах, проводимых под эгидой РШФ. Для просмотре статистики необходимо ввести свой РШФ ID и нажать кнопку "Получить".<br />
                <strong>Особенности работы</strong><br />
                Сайт собирает данные только о турнирах проводимых по швейцарской и круговой системах.<br />
                Все ошибки на сайте записываются и я их регулярно просматриваю. Так что, если у вас сейчас возникла ошибка - попробуйте позже, возможно она будет исправлена.
                <strong>Контакты</strong><br/>
                Все замечания, предложения и сообщения об ошибках можете направлять по следующим контактам:<br />
                <a href="mailto:byte916@yandex.ru">byte916@yandex.ru</a><br />
                <a href="https://vk.com/id2962981" target="_blank">Вконтакте</a>
            </div>
        </div>
    </div>
</div>
</body>
</html>